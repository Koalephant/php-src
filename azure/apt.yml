parameters:
  packages: ''

steps:
  - script: |
      if ! grep -r -E '^deb.*xenial-backports.*' /etc/apt/sources.list* > /dev/null; then
      cat <<EOT | sudo tee /etc/apt/sources.list.d/xenial-backports.list > /dev/null
      deb http://archive.ubuntu.com/ubuntu/ xenial-backports main restricted universe multiverse
      EOT
      fi

      cat <<EOT | sudo tee /etc/apt/preferences.d/xenial-backports-lmdb > /dev/null
      Package: liblmdb-dev liblmdb0 lmdb-doc
      Pin: release a=xenial-backports
      Pin-Priority: 500
      EOT

      sudo apt-get update -y | true
      sudo apt install bison \
                       re2c \
                       locales \
                       language-pack-de \
                       re2c \
                       libgmp-dev \
                       libicu-dev \
                       libtidy-dev \
                       libenchant-dev \
                       libaspell-dev \
                       libpspell-dev \
                       libsasl2-dev \
                       libxpm-dev \
                       libzip-dev \
                       libsqlite3-dev \
                       libwebp-dev \
                       libonig-dev \
                       libkrb5-dev \
                       libgssapi-krb5-2 \
                       libcurl4-openssl-dev \
                       libxml2-dev \
                       libxslt1-dev \
                       libpq-dev \
                       libreadline-dev \
                       libldap2-dev \
                       libsasl2-dev \
                       libargon2-0-dev \
                       postgresql \
                       postgresql-contrib \
                       llvm \
                       liblmdb-dev \
                       libqdbm-dev \
                       libtokyocabinet-dev \
                       ${{ parameters.packages }}
    displayName: 'APT'
